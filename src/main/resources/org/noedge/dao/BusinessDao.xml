<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.4//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.noedge.dao.BusinessDao">
    <select id="selectTodayLivingNumByHostelIdAndDate" resultType="Integer">
        SELECT o.hostel_id,sum(r.living_num) living_number FROM check_in_room r LEFT JOIN check_in_order o ON r.order_id = o.id AND o.hostel_id in
                <foreach item="item" index="index" collection="list" open="("  close=")" separator=",">
                       #{arg0}
                </foreach>
             AND o.check_in_date <![CDATA[ <= ]]> #{arg1} AND o.check_out_date > #{arg1} group by o.hostel_id
    </select>
    <select id="selectTotalLivingNumByHostelId" resultType="Integer" parameterType="list">
        select hostel_id,sum(living_num) total_num from room where hostel_id in
        <foreach item="item" index="index" collection="list" open="("  close=")" separator=",">
            #{hostelIds}
        </foreach>
        group by hostel_id
    </select>

    <select id="selectHostelLivingNumAll" resultType="map">
        SELECT one.hostel_id,one.living_num,two.total_num FROM (SELECT o.hostel_id,sum(r.living_num) living_num FROM check_in_room r LEFT JOIN check_in_order o ON r.order_id = o.id AND o.hostel_id in
        <foreach item="item" index="index" collection="arg0" open="("  close=")" separator=",">
            #{item}
        </foreach>
        AND o.check_in_date <![CDATA[ <= ]]> #{arg1} AND o.check_out_date > #{arg1} group by o.hostel_id) one
        LEFT JOIN
            (select hostel_id,sum(living_num) total_num from room where hostel_id in
        <foreach item="item" index="index" collection="arg0" open="("  close=")" separator=",">
            #{item}
        </foreach>
        group by hostel_id) two
        ON one.hostel_id = two.hostel_id
    </select>

</mapper>