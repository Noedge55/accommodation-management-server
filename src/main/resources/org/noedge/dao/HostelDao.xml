<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.4//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.noedge.dao.HostelDao">
    <resultMap id="resultMap" type="Hostel">
        <id property="id" column="id" javaType="Integer"/>
        <id property="name" column="name" javaType="String"/>
        <id property="area" column="area" javaType="String"/>
        <id property="address" column="address" javaType="String"/>
        <id property="createTime" column="create_time" javaType="String"/>
        <id property="updateTime" column="update_time" javaType="String"/>
        <id property="createPId" column="create_p_id" javaType="Integer"/>
        <id property="lastUpdatePID" column="last_update_p_id" javaType="Integer"/>
    </resultMap>

    <select id="selectAll" resultMap="resultMap">
        SELECT id,name,area,address,create_time,update_time,create_p_id,last_update_p_id from hostel
    </select>

    <select id="selectAllByPIdPermission" resultMap="resultMap" parameterType="Integer">
        SELECT DISTINCT h.id,h.name,h.area,h.address,h.create_time,h.update_time,h.create_p_id,h.last_update_p_id from hostel h RIGHT JOIN (SELECT p1.hostel_id hostel_id from permission p1 WHERE p1.person_id = #{permissionPId} AND p1.type = 0
                                                                                                                                            UNION ALL
                                                                                                                                            SELECT p2.hostel_id hostel_id FROM permission p2 WHERE p2.group_id = (SELECT p.group_id FROM person p where p.id = #{permissionPId}) AND p2.type = #{permissionPId}) as total on h.id = total.hostel_id
    </select>

</mapper>